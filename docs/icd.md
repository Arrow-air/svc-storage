# Interface Control Document (ICD) - `svc-storage`

<center>

<img src="https://github.com/Arrow-air/tf-github/raw/main/src/templates/doc-banner-services.png" style="height:250px" />

</center>

## Overview

This document defines the gRPC interfaces unique to the `svc-storage` microservice.

Attribute | Description
--- | ---
Status | Draft

## Related Documents

Document | Description
--- | ---
[Requirements - `svc-storage`](https://docs.google.com/spreadsheets/d/1OQZGOxQh7gWo3BeZzwwHNSdY84Ghucx2MVADVlXV4AY/edit?usp=sharing) | Requirements for this module
[Software Design Document (SDD)](./sdd.md) | 

## Frameworks

See [High-Level Services ICD](https://github.com/Arrow-air/se-services/blob/develop/docs/icd.md).

## gRPC

### Files

These interfaces are defined in protocol buffer files:
 * [`svc-storage-grpc-adsb.proto`](../proto/svc-storage-grpc-adsb.proto)
 * [`svc-storage-grpc-adsb-service.proto`](../proto/svc-storage-grpc-adsb-service.proto)
 * [`svc-storage-grpc-flight_plan.proto`](../proto/svc-storage-grpc-flight_plan.proto)
 * [`svc-storage-grpc-flight_plan-service.proto`](../proto/svc-storage-grpc-flight_plan-service.proto)
 * [`svc-storage-grpc-itinerary.proto`](../proto/svc-storage-grpc-itinerary.proto)
 * [`svc-storage-grpc-itinerary-service.proto`](../proto/svc-storage-grpc-itinerary-service.proto)
 * [`svc-storage-grpc-pilot.proto`](../proto/svc-storage-grpc-pilot.proto)
 * [`svc-storage-grpc-pilot-service.proto`](../proto/svc-storage-grpc-pilot-service.proto)
 * [`svc-storage-grpc.proto`](../proto/svc-storage-grpc.proto)
 * [`svc-storage-grpc-vehicle.proto`](../proto/svc-storage-grpc-vehicle.proto)
 * [`svc-storage-grpc-vehicle-service.proto`](../proto/svc-storage-grpc-vehicle-service.proto)
 * [`svc-storage-grpc-vertipad.proto`](../proto/svc-storage-grpc-vertipad.proto)
 * [`svc-storage-grpc-vertipad-service.proto`](../proto/svc-storage-grpc-vertipad-service.proto)
 * [`svc-storage-grpc-vertiport.proto`](../proto/svc-storage-grpc-vertiport.proto)
 * [`svc-storage-grpc-vertiport-service.proto`](../proto/svc-storage-grpc-vertiport-service.proto)

### Integrated Authentication & Encryption

See [High-Level Services ICD](https://github.com/Arrow-air/se-services/blob/develop/docs/icd.md#space_invader-integrated-authentication--encryption).

### gRPC Server Methods ("Services")

gRPC server methods are called "services", an unfortunate name clash with the broader concept of web services.

â’¾ ***A more detailed API description will be available in the next release***

#### StorageRpc

| Service | Description |
| ---- | ---- |
| `isReady` | Returns a message indicating if this service is ready for requests.<br>Similar to a health check, if a server is not "ready" it could be considered dead by the client making the request.

#### SimpleResourceRpc

Implemented for:
 * adsb
 * flight_plan
 * itinerary
 * pilot
 * vehicle
 * vertipad
 * vertiport

| Service     | Description |
| ----------- | ----------- |
| `get_by_id` | Takes an [`Id`] object to retrieve the resource's record data. Returns a [`tonic`] gRCP [`Response`] containing an [`Object`].
| `search`    | Takes an [`AdvancedSearchFilter`] object to search the database with the provided values. Returns a list of [`Objects`] found in the database.
| `insert`    | Takes a [`Data`] object to create a new resource record with the provided data. A new [`Uuid`] will be generated by the database and returned as `id` as part of the returned [`Object`].
| `update`    | Takes an [`UpdateObject`] to update the resource with new data in the database. A field mask can be provided to restrict updates to specific fields. Returns the updated [`Response`] on success.
| `delete`    | Takes an [`Id`] to set the matching resource record as deleted in the database.

#### LinkedResourceRpc

Implemented for:
 * itinerary_flight_plan

| Service          | Description |
| ---------------- | ----------- |
| `link`           | Takes an [`LinkOtherResource`] object to link the provided resource ids in the database. Inserts new entries into the database for each `id`, `other_id` combination if they don't exist yet. The existence of the provided resource `id` will be validated before insert. Returns an empty [`tonic`] gRCP [`Response`].
| `replace_linked` | Takes an [`LinkOtherResource`] object replace the provided resource linked ids in the database. Inserts new entries into the database for each `id`, `other_id` combination. All existing entries will be removed first. The existence of the provided resource `id` will be validated before insert. Returns an empty [`tonic`] gRCP [`Response`].
| `unlink`         | Takes an [`Id`] to unlink all resource linked ids in the database. Removes all entries from the link table for the given `id`. he existence of the provided resource `id` will be validated before unlink. Returns an empty [`tonic`] gRCP [`Response`].
| `get_linked_ids` | Takes an [`Id`] to retrieve linked ids from the database. The existence of the provided resource `id` will be validated first. Returns a [`tonic`] gRCP [`Response`] with [`IdList`] of found ids.
| `get_linked`     | Takes an [`Id`] to retrieve linked resources from the database. The existence of the provided resource `id` will be validated first. Returns a [`tonic`] gRCP [`Response`] with [`List`] of found linked resources.

### gRPC Client Messages ("Requests")

The `svc-storage` service does not request any data from other services.
